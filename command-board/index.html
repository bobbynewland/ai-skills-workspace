<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mission Control - Task Board</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #0a0a0f; color: #e5e5e5; min-height: 100vh; padding-bottom: 100px; }
        .header { padding: 20px; position: sticky; top: 0; background: #0a0a0f; z-index: 100; }
        .header h1 { font-size: 1.5rem; font-weight: 600; background: linear-gradient(135deg, #fff, #a78bfa); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .header p { color: #6b7280; font-size: 0.875rem; margin-top: 4px; }
        .status-indicator { display: inline-flex; align-items: center; gap: 6px; font-size: 0.75rem; margin-left: 12px; padding: 4px 10px; border-radius: 20px; }
        .status-indicator.saving { background: rgba(251, 191, 36, 0.2); color: #fbbf24; }
        .status-indicator.saved { background: rgba(52, 211, 153, 0.2); color: #34d399; }
        .status-indicator.error { background: rgba(248, 113, 113, 0.2); color: #f87171; }
        .status-dot { width: 6px; height: 6px; border-radius: 50%; }
        .status-dot.saving { background: #fbbf24; animation: pulse 1s infinite; }
        .status-dot.saved { background: #34d399; }
        .status-dot.error { background: #f87171; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        .stats-bar { display: flex; gap: 8px; padding: 0 20px 20px; flex-wrap: wrap; }
        .stat-pill { background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.08); border-radius: 20px; padding: 8px 16px; font-size: 0.8rem; }
        .stat-pill span { color: #a78bfa; font-weight: 600; }
        .board { display: flex; gap: 16px; padding: 0 20px; overflow-x: auto; padding-bottom: 120px; }
        .column { min-width: 280px; max-width: 280px; flex-shrink: 0; }
        .column-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 16px; padding-bottom: 12px; border-bottom: 2px solid; }
        .column-header h3 { font-size: 0.9rem; font-weight: 600; display: flex; align-items: center; gap: 8px; }
        .column-count { background: rgba(255,255,255,0.1); padding: 2px 8px; border-radius: 10px; font-size: 0.75rem; }
        .todo .column-header { border-color: #f87171; }
        .progress .column-header { border-color: #fbbf24; }
        .review .column-header { border-color: #34d399; }
        .done .column-header { border-color: #60a5fa; }
        .cards-container { display: flex; flex-direction: column; gap: 10px; min-height: 100px; padding: 8px; border-radius: 8px; transition: background 0.2s; }
        .cards-container.drag-over { background: rgba(167, 139, 250, 0.15); }
        .card { background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.06); border-radius: 12px; padding: 16px; cursor: grab; transition: all 0.2s; }
        .card:active { cursor: grabbing; }
        .card:hover { background: rgba(255,255,255,0.05); transform: translateY(-2px); }
        .card-title { font-weight: 500; font-size: 0.95rem; margin-bottom: 8px; }
        .card-meta { display: flex; align-items: center; gap: 8px; flex-wrap: wrap; }
        .tag { font-size: 0.7rem; padding: 4px 10px; border-radius: 6px; }
        .tag-dev { background: rgba(96, 165, 250, 0.15); color: #60a5fa; }
        .tag-marketing { background: rgba(248, 113, 113, 0.15); color: #f87171; }
        .tag-content { background: rgba(251, 191, 36, 0.15); color: #fbbf24; }
        .tag-ambassador { background: rgba(52, 211, 153, 0.15); color: #34d399; }
        .tag-ops { background: rgba(167, 139, 250, 0.15); color: #a78bfa; }
        .priority-dot { width: 8px; height: 8px; border-radius: 50%; }
        .priority-high { background: #f87171; }
        .priority-medium { background: #fbbf24; }
        .priority-low { background: #34d399; }
        .fab { position: fixed; bottom: 24px; right: 24px; width: 56px; height: 56px; border-radius: 16px; background: linear-gradient(135deg, #a78bfa, #7c3aed); border: none; color: white; font-size: 1.5rem; cursor: pointer; box-shadow: 0 10px 40px rgba(124, 58, 237, 0.4); z-index: 100; }
        .modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.8); z-index: 1000; align-items: flex-end; justify-content: center; }
        .modal.active { display: flex; }
        .modal-content { background: #16161c; width: 100%; max-width: 500px; border-radius: 24px 24px 0 0; padding: 24px; max-height: 85vh; overflow-y: auto; }
        @media (min-width: 768px) { .modal-content { margin: auto; border-radius: 24px; } .board { padding: 0 40px; } }
        .modal-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 20px; }
        .modal-header h2 { font-size: 1.25rem; font-weight: 600; }
        .close-btn { width: 36px; height: 36px; border-radius: 10px; background: rgba(255,255,255,0.05); border: none; color: #9ca3af; font-size: 1.25rem; cursor: pointer; }
        .form-group { margin-bottom: 16px; }
        .form-group label { display: block; color: #9ca3af; font-size: 0.8rem; margin-bottom: 8px; }
        .form-group input, .form-group select, .form-group textarea { width: 100%; padding: 14px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 12px; color: #fff; font-size: 1rem; }
        .form-group textarea { min-height: 100px; resize: none; }
        .btn-group { display: flex; gap: 12px; margin-top: 20px; }
        .btn { flex: 1; padding: 14px; border-radius: 12px; font-weight: 600; font-size: 0.95rem; cursor: pointer; border: none; }
        .btn-primary { background: linear-gradient(135deg, #a78bfa, #7c3aed); color: white; }
        .btn-secondary { background: rgba(255,255,255,0.05); color: #e5e5e5; border: 1px solid rgba(255,255,255,0.1); }
        .btn-danger { background: rgba(248, 113, 113, 0.15); color: #f87171; }
    </style>
</head>
<body>
    <div class="header">
        <h1>üöÄ Mission Control</h1>
        <p>Your task board</p>
        <span class="status-indicator saving" id="statusIndicator">
            <span class="status-dot saving"></span>
            <span id="statusText">Initializing...</span>
        </span>
    </div>
    
    <div class="stats-bar">
        <div class="stat-pill">Total: <span id="stat-total">0</span></div>
        <div class="stat-pill">To Do: <span id="stat-todo">0</span></div>
        <div class="stat-pill">In Progress: <span id="stat-progress">0</span></div>
        <div class="stat-pill">Done: <span id="stat-done">0</span></div>
    </div>
    
    <div class="board">
        <div class="column todo">
            <div class="column-header">
                <h3>üìã To Do <span class="column-count" id="count-todo">0</span></h3>
            </div>
            <div class="cards-container" id="col-todo"></div>
        </div>
        <div class="column progress">
            <div class="column-header">
                <h3>üî• In Progress <span class="column-count" id="count-progress">0</span></h3>
            </div>
            <div class="cards-container" id="col-progress"></div>
        </div>
        <div class="column review">
            <div class="column-header">
                <h3>üëÄ Review <span class="column-count" id="count-review">0</span></h3>
            </div>
            <div class="cards-container" id="col-review"></div>
        </div>
        <div class="column done">
            <div class="column-header">
                <h3>‚úÖ Done <span class="column-count" id="count-done">0</span></h3>
            </div>
            <div class="cards-container" id="col-done"></div>
        </div>
    </div>
    
    <button class="fab" onclick="openAddModal()">+</button>
    
    <!-- Add Task Modal -->
    <div class="modal" id="addModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>New Task</h2>
                <button class="close-btn" onclick="closeModal('addModal')">√ó</button>
            </div>
            <form onsubmit="submitNewTask(event)">
                <div class="form-group">
                    <label>Title</label>
                    <input type="text" id="addTitle" placeholder="What needs to be done?" required>
                </div>
                <div class="form-group">
                    <label>Description</label>
                    <textarea id="addDesc" placeholder="Add details..."></textarea>
                </div>
                <div class="form-group">
                    <label>Category</label>
                    <select id="addCategory">
                        <option value="dev">üíª Dev</option>
                        <option value="marketing">üì£ Marketing</option>
                        <option value="content">üé® Content</option>
                        <option value="ambassador">ü§ù Ambassador</option>
                        <option value="ops">‚öôÔ∏è Ops</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Priority</label>
                    <select id="addPriority">
                        <option value="high">üî¥ High</option>
                        <option value="medium">üü° Medium</option>
                        <option value="low">üü¢ Low</option>
                    </select>
                </div>
                <div class="btn-group">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('addModal')">Cancel</button>
                    <button type="submit" class="btn btn-primary">Create</button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Edit Task Modal -->
    <div class="modal" id="editModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Task Details</h2>
                <button class="close-btn" onclick="closeModal('editModal')">√ó</button>
            </div>
            <form onsubmit="saveTask(event)">
                <input type="hidden" id="editId">
                <div class="form-group">
                    <label>Status</label>
                    <select id="editStatus">
                        <option value="todo">üìã To Do</option>
                        <option value="progress">üî• In Progress</option>
                        <option value="review">üëÄ Review</option>
                        <option value="done">‚úÖ Done</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Title</label>
                    <input type="text" id="editTitle" required>
                </div>
                <div class="form-group">
                    <label>Description</label>
                    <textarea id="editDesc"></textarea>
                </div>
                <div class="form-group">
                    <label>Category</label>
                    <select id="editCategory">
                        <option value="dev">üíª Dev</option>
                        <option value="marketing">üì£ Marketing</option>
                        <option value="content">üé® Content</option>
                        <option value="ambassador">ü§ù Ambassador</option>
                        <option value="ops">‚öôÔ∏è Ops</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Priority</label>
                    <select id="editPriority">
                        <option value="high">üî¥ High</option>
                        <option value="medium">üü° Medium</option>
                        <option value="low">üü¢ Low</option>
                    </select>
                </div>
                <div class="btn-group">
                    <button type="button" class="btn btn-danger" onclick="deleteTask()">Delete</button>
                    <button type="submit" class="btn btn-primary">Save</button>
                </div>
            </form>
        </div>
    </div>
    
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getDatabase, ref, set, onValue, remove, update } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js';
        
        // Firebase config
        const firebaseConfig = {
            apiKey: "AIzaSyB3Z1WDeqO4cEBMk5Q1j9H8c2-0Z1Y8X0",
            authDomain: "winslow-756c3.firebaseapp.com",
            databaseURL: "https://winslow-756c3-default-rtdb.firebaseio.com",
            projectId: "winslow-756c3",
            storageBucket: "winslow-756c3.appspot.com",
            messagingSenderId: "123456789",
            appId: "1:123456789:web:abc123"
        };
        
        let db = null;
        let tasks = {};
        let isFirebaseReady = false;
        
        // Status indicator
        function setStatus(status, text) {
            const indicator = document.getElementById('statusIndicator');
            const dot = indicator.querySelector('.status-dot');
            const textEl = document.getElementById('statusText');
            indicator.className = 'status-indicator ' + status;
            dot.className = 'status-dot ' + status;
            textEl.textContent = text;
        }
        
        // Initialize Firebase
        try {
            const app = initializeApp(firebaseConfig);
            db = getDatabase(app);
            setStatus('saving', 'Connecting to Firebase...');
            setStatus('saved', 'Firebase connected ‚úì');
            isFirebaseReady = true;
            console.log('Firebase initialized');
        } catch(e) {
            console.error('Firebase init error:', e);
            setStatus('error', 'Firebase offline - using localStorage');
            isFirebaseReady = false;
        }
        
        // Load tasks from Firebase or localStorage
        window.loadTasks = async function() {
            if (isFirebaseReady && db) {
                const tasksRef = ref(db, 'workspaces/winslow_main/tasks');
                onValue(tasksRef, (snapshot) => {
                    const data = snapshot.val();
                    if (data) {
                        tasks = data;
                        saveToLocalStorage();
                        renderBoard();
                        setStatus('saved', 'Synced from Firebase ‚úì');
                    } else {
                        loadFromLocalStorage();
                    }
                }, (error) => {
                    console.error('Firebase read error:', error);
                    loadFromLocalStorage();
                });
            } else {
                loadFromLocalStorage();
            }
        };
        
        function saveToLocalStorage() {
            localStorage.setItem('mission_tasks_backup', JSON.stringify(tasks));
        }
        
        function loadFromLocalStorage() {
            const saved = localStorage.getItem('mission_tasks_backup');
            if (saved) {
                tasks = JSON.parse(saved);
                renderBoard();
                setStatus('saved', 'Loaded from localStorage');
            } else {
                // Default tasks
                tasks = {
                    '1': { id: '1', title: "Welcome to Mission Control", desc: "Click a task to edit. Use the Status dropdown to move between columns.", category: "ops", priority: "medium", status: "todo" },
                    '2': { id: '2', title: "Try changing status", desc: "Open a task and use the Status dropdown to move it.", category: "dev", priority: "low", status: "todo" },
                    '3': { id: '3', title: "Add your own tasks", desc: "Click the + button to create new tasks", category: "marketing", priority: "high", status: "progress" }
                };
                saveTasks();
                setStatus('saved', 'Default tasks loaded');
            }
        }
        
        async function saveTasks() {
            if (isFirebaseReady && db) {
                try {
                    setStatus('saving', 'Saving to Firebase...');
                    await set(ref(db, 'workspaces/winslow_main/tasks'), tasks);
                    saveToLocalStorage();
                    setStatus('saved', 'Saved to Firebase ‚úì');
                } catch(e) {
                    console.error('Firebase save error:', e);
                    saveToLocalStorage();
                    setStatus('error', 'Saved locally only');
                }
            } else {
                saveToLocalStorage();
                setStatus('saved', 'Saved locally');
            }
        }
        
        window.renderBoard = function() {
            // Clear columns
            ['todo', 'progress', 'review', 'done'].forEach(status => {
                document.getElementById('col-' + status).innerHTML = '';
            });
            
            // Add cards
            Object.values(tasks).forEach(task => {
                const card = createCard(task);
                const container = document.getElementById('col-' + task.status);
                if (container) container.appendChild(card);
            });
            
            renderStats();
            setTimeout(setupDragDrop, 100); // Re-setup drag-drop
        }
        
        function createCard(task) {
            const div = document.createElement('div');
            div.className = 'card';
            div.dataset.id = task.id;
            div.draggable = true;
            div.innerHTML = '<div class="card-title">' + task.title + '</div>' +
                '<div class="card-meta">' +
                '<span class="tag tag-' + task.category + '">' + getCategoryLabel(task.category) + '</span>' +
                '<span class="priority-dot priority-' + task.priority + '"></span>' +
                '</div>';
            div.onclick = () => window.openEditModal(task.id);
            return div;
        }
        
        function getCategoryLabel(cat) {
            const labels = { dev: 'Dev', marketing: 'Marketing', content: 'Content', ambassador: 'Ambassador', ops: 'Ops' };
            return labels[cat] || cat;
        }
        
        window.renderStats = function() {
            const counts = { total: Object.keys(tasks).length, todo: 0, progress: 0, review: 0, done: 0 };
            Object.values(tasks).forEach(t => { if (counts[t.status] !== undefined) counts[t.status]++; });
            
            document.getElementById('stat-total').textContent = counts.total;
            document.getElementById('stat-todo').textContent = counts.todo;
            document.getElementById('stat-progress').textContent = counts.progress;
            document.getElementById('stat-done').textContent = counts.done;
            document.getElementById('count-todo').textContent = counts.todo;
            document.getElementById('count-progress').textContent = counts.progress;
            document.getElementById('count-review').textContent = counts.review;
            document.getElementById('count-done').textContent = counts.done;
        }
        
        window.openAddModal = function() {
            document.getElementById('addTitle').value = '';
            document.getElementById('addDesc').value = '';
            document.getElementById('addModal').classList.add('active');
            document.getElementById('addTitle').focus();
        }
        
        window.openEditModal = function(id) {
            const task = tasks[id];
            if (!task) return;
            document.getElementById('editId').value = id;
            document.getElementById('editTitle').value = task.title;
            document.getElementById('editDesc').value = task.desc || '';
            document.getElementById('editStatus').value = task.status;
            document.getElementById('editCategory').value = task.category;
            document.getElementById('editPriority').value = task.priority;
            document.getElementById('editModal').classList.add('active');
        }
        
        window.closeModal = function(id) {
            document.getElementById(id).classList.remove('active');
        }
        
        window.submitNewTask = async function(e) {
            e.preventDefault();
            const id = Date.now().toString();
            tasks[id] = {
                id: id,
                title: document.getElementById('addTitle').value,
                desc: document.getElementById('addDesc').value,
                category: document.getElementById('addCategory').value,
                priority: document.getElementById('addPriority').value,
                status: 'todo',
                createdAt: Date.now()
            };
            await saveTasks();
            renderBoard();
            closeModal('addModal');
            e.target.reset();
        }
        
        window.saveTask = async function(e) {
            e.preventDefault();
            const id = document.getElementById('editId').value;
            if (!tasks[id]) return;
            tasks[id].title = document.getElementById('editTitle').value;
            tasks[id].desc = document.getElementById('editDesc').value;
            tasks[id].status = document.getElementById('editStatus').value;
            tasks[id].category = document.getElementById('editCategory').value;
            tasks[id].priority = document.getElementById('editPriority').value;
            tasks[id].updatedAt = Date.now();
            await saveTasks();
            renderBoard();
            closeModal('editModal');
        }
        
        window.deleteTask = async function() {
            const id = document.getElementById('editId').value;
            if (!id) return;
            if (!confirm('Delete this task?')) return;
            delete tasks[id];
            await saveTasks();
            renderBoard();
            closeModal('editModal');
        }
        
        // Close modal on background click
        document.querySelectorAll('.modal').forEach(modal => {
            modal.onclick = function(e) { if (e.target === modal) closeModal(modal.id); };
        });
        
        // Drag and Drop
        let draggedCard = null;
        
        function setupDragDrop() {
            const cards = document.querySelectorAll('.card');
            const containers = document.querySelectorAll('.cards-container');
            
            cards.forEach(card => {
                card.draggable = true;
                card.addEventListener('dragstart', (e) => {
                    draggedCard = card;
                    card.style.opacity = '0.5';
                    e.dataTransfer.effectAllowed = 'move';
                });
                card.addEventListener('dragend', () => {
                    card.style.opacity = '1';
                    draggedCard = null;
                    containers.forEach(c => c.classList.remove('drag-over'));
                });
            });
            
            containers.forEach(container => {
                container.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    container.classList.add('drag-over');
                });
                container.addEventListener('dragleave', () => {
                    container.classList.remove('drag-over');
                });
                container.addEventListener('drop', async (e) => {
                    e.preventDefault();
                    container.classList.remove('drag-over');
                    if (draggedCard) {
                        const newStatus = container.id.replace('col-', '');
                        const taskId = draggedCard.dataset.id;
                        if (tasks[taskId] && tasks[taskId].status !== newStatus) {
                            tasks[taskId].status = newStatus;
                            tasks[taskId].updatedAt = Date.now();
                            await saveTasks();
                            renderBoard();
                        }
                    }
                });
            });
        }
        
        // Initialize
        window.loadTasks();
        setTimeout(setupDragDrop, 100);
    </script>
</body>
</html>