<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Mission Control</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; 
            background: #0a0a0f; 
            color: #e5e5e5; 
            min-height: 100vh; 
            overflow-x: hidden;
        }
        
        /* Header */
        .header { 
            padding: 20px; 
            background: linear-gradient(180deg, #0a0a0f 0%, transparent 100%);
            position: sticky; 
            top: 0; 
            z-index: 100;
        }
        .header h1 { 
            font-size: 1.5rem; 
            font-weight: 600; 
            background: linear-gradient(135deg, #fff 0%, #a78bfa 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .header p { color: #6b7280; font-size: 0.875rem; margin-top: 4px; }
        
        /* Stats Bar */
        .stats-bar { 
            display: flex; 
            gap: 8px; 
            padding: 0 20px 20px; 
            overflow-x: auto; 
            -webkit-overflow-scrolling: touch;
        }
        .stat-pill { 
            background: rgba(255,255,255,0.05); 
            border: 1px solid rgba(255,255,255,0.08); 
            border-radius: 20px; 
            padding: 8px 16px; 
            font-size: 0.8rem; 
            white-space: nowrap;
        }
        .stat-pill span { color: #a78bfa; font-weight: 600; }
        
        /* Board */
        .board { 
            display: flex; 
            gap: 12px; 
            padding: 0 20px 100px; 
            overflow-x: auto; 
            -webkit-overflow-scrolling: touch;
            padding-bottom: 120px;
        }
        .column { 
            min-width: 300px; 
            max-width: 300px; 
            flex-shrink: 0;
        }
        .column-header { 
            display: flex; 
            align-items: center; 
            justify-content: space-between; 
            margin-bottom: 16px; 
            padding-bottom: 12px; 
            border-bottom: 2px solid;
        }
        .column-title { 
            display: flex; 
            align-items: center; 
            gap: 8px; 
            font-weight: 600; 
            font-size: 0.9rem;
        }
        .column-count { 
            background: rgba(255,255,255,0.1); 
            padding: 2px 8px; 
            border-radius: 10px; 
            font-size: 0.75rem; 
            color: #9ca3af;
        }
        .todo .column-header { border-color: #f87171; }
        .progress .column-header { border-color: #fbbf24; }
        .review .column-header { border-color: #34d399; }
        .done .column-header { border-color: #60a5fa; }
        
        /* Cards */
        .cards { display: flex; flex-direction: column; gap: 10px; }
        .card { 
            background: rgba(255,255,255,0.03); 
            border: 1px solid rgba(255,255,255,0.06); 
            border-radius: 12px; 
            padding: 16px; 
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .card:active { transform: scale(0.98); }
        .card:hover { 
            background: rgba(255,255,255,0.05); 
            border-color: rgba(255,255,255,0.1);
        }
        .card-title { 
            font-weight: 500; 
            font-size: 0.95rem; 
            margin-bottom: 8px; 
            line-height: 1.4;
        }
        .card-meta { 
            display: flex; 
            align-items: center; 
            gap: 8px; 
            flex-wrap: wrap;
        }
        .tag { 
            font-size: 0.7rem; 
            padding: 4px 10px; 
            border-radius: 6px; 
            font-weight: 500;
        }
        .tag-dev { background: rgba(96, 165, 250, 0.15); color: #60a5fa; }
        .tag-marketing { background: rgba(248, 113, 113, 0.15); color: #f87171; }
        .tag-content { background: rgba(251, 191, 36, 0.15); color: #fbbf24; }
        .tag-ambassador { background: rgba(52, 211, 153, 0.15); color: #34d399; }
        .tag-ops { background: rgba(167, 139, 250, 0.15); color: #a78bfa; }
        
        .priority-dot { width: 8px; height: 8px; border-radius: 50%; }
        .priority-high { background: #f87171; }
        .priority-medium { background: #fbbf24; }
        .priority-low { background: #34d399; }
        
        .file-indicator { 
            margin-left: auto; 
            color: #6b7280; 
            font-size: 0.75rem;
        }
        
        /* FAB */
        .fab { 
            position: fixed; 
            bottom: 24px; 
            right: 24px; 
            width: 56px; 
            height: 56px; 
            border-radius: 16px; 
            background: linear-gradient(135deg, #a78bfa 0%, #7c3aed 100%);
            border: none; 
            color: white; 
            font-size: 1.5rem; 
            cursor: pointer;
            box-shadow: 0 10px 40px rgba(124, 58, 237, 0.4);
            z-index: 100;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        /* Bottom Sheet Modal */
        .modal { 
            display: none; 
            position: fixed; 
            inset: 0; 
            background: rgba(0,0,0,0.8); 
            z-index: 1000;
            align-items: flex-end;
            justify-content: center;
        }
        .modal.active { display: flex; }
        .modal-content { 
            background: #16161c; 
            width: 100%; 
            max-width: 600px; 
            border-radius: 24px 24px 0 0; 
            padding: 24px;
            max-height: 85vh;
            overflow-y: auto;
            animation: slideUp 0.3s ease;
        }
        @keyframes slideUp {
            from { transform: translateY(100%); }
            to { transform: translateY(0); }
        }
        .modal-header { 
            display: flex; 
            align-items: center; 
            justify-content: space-between; 
            margin-bottom: 20px;
        }
        .modal-header h2 { font-size: 1.25rem; font-weight: 600; }
        .close-btn { 
            width: 36px; 
            height: 36px; 
            border-radius: 10px; 
            background: rgba(255,255,255,0.05); 
            border: none; 
            color: #9ca3af; 
            font-size: 1.25rem;
            cursor: pointer;
        }
        
        /* Form Elements */
        .form-group { margin-bottom: 16px; }
        .form-group label { 
            display: block; 
            color: #9ca3af; 
            font-size: 0.8rem; 
            margin-bottom: 8px; 
            font-weight: 500;
        }
        .form-group input, .form-group select, .form-group textarea { 
            width: 100%; 
            padding: 14px; 
            background: rgba(255,255,255,0.05); 
            border: 1px solid rgba(255,255,255,0.1); 
            border-radius: 12px; 
            color: #fff; 
            font-size: 1rem;
            -webkit-appearance: none;
        }
        .form-group textarea { min-height: 100px; resize: none; line-height: 1.5; }
        .form-group select { 
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' fill='%239ca3af' viewBox='0 0 16 16'%3E%3Cpath d='M8 11L3 6h10l-5 5z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 12px center;
        }
        
        /* Buttons */
        .btn-group { display: flex; gap: 12px; margin-top: 20px; }
        .btn { 
            flex: 1; 
            padding: 14px; 
            border-radius: 12px; 
            font-weight: 600; 
            font-size: 0.95rem;
            cursor: pointer;
            transition: all 0.2s;
            border: none;
        }
        .btn-primary { 
            background: linear-gradient(135deg, #a78bfa 0%, #7c3aed 100%); 
            color: white;
        }
        .btn-secondary { 
            background: rgba(255,255,255,0.05); 
            color: #e5e5e5; 
            border: 1px solid rgba(255,255,255,0.1);
        }
        .btn-danger { 
            background: rgba(248, 113, 113, 0.15); 
            color: #f87171;
        }
        .btn:active { transform: scale(0.98); }
        
        .btn-full { width: 100%; margin-top: 12px; }
        
        /* File Upload */
        .file-upload { 
            border: 2px dashed rgba(255,255,255,0.1); 
            border-radius: 12px; 
            padding: 24px; 
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
        }
        .file-upload:active { background: rgba(255,255,255,0.05); }
        .file-upload input { display: none; }
        .file-upload-icon { font-size: 1.5rem; margin-bottom: 8px; }
        .file-upload-text { color: #9ca3af; font-size: 0.85rem; }
        
        .file-list { margin-top: 12px; display: flex; flex-direction: column; gap: 8px; }
        .file-item { 
            display: flex; align-items: center; gap: 10px; 
            padding: 10px; 
            background: rgba(255,255,255,0.03); 
            border-radius: 8px;
        }
        .file-item-icon { font-size: 1.25rem; }
        .file-item-name { flex: 1; font-size: 0.85rem; }
        .file-item-remove { 
            background: none; border: none; color: #6b7280; 
            font-size: 1.25rem; cursor: pointer;
        }
        
        /* Drag Handle */
        .drag-handle { 
            position: fixed; 
            bottom: 100px; 
            left: 50%; 
            transform: translateX(-50%);
            background: rgba(255,255,255,0.1); 
            padding: 12px 24px; 
            border-radius: 20px; 
            color: #6b7280; 
            font-size: 0.8rem;
            display: none;
            z-index: 99;
        }
        .card.dragging { opacity: 0.5; }
        .column.drag-over { background: rgba(167, 139, 250, 0.1); border-radius: 12px; }
        
        /* Responsive */
        @media (min-width: 768px) {
            .board { gap: 20px; padding: 0 40px 100px; }
            .column { min-width: 320px; max-width: 320px; }
            .modal-content { margin: auto; border-radius: 24px; }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üöÄ Mission Control</h1>
        <p>Your command center</p>
    </div>
    
    <div class="stats-bar">
        <div class="stat-pill">Total: <span id="stat-total">0</span></div>
        <div class="stat-pill">To Do: <span id="stat-todo">0</span></div>
        <div class="stat-pill">In Progress: <span id="stat-progress">0</span></div>
        <div class="stat-pill">Done: <span id="stat-done">0</span></div>
    </div>
    
    <div class="board">
        <div class="column todo" data-column="todo">
            <div class="column-header">
                <div class="column-title">üìã To Do <span class="column-count">0</span></div>
            </div>
            <div class="cards" data-status="todo"></div>
        </div>
        <div class="column progress" data-column="progress">
            <div class="column-header">
                <div class="column-title">üî• In Progress <span class="column-count">0</span></div>
            </div>
            <div class="cards" data-status="progress"></div>
        </div>
        <div class="column review" data-column="review">
            <div class="column-header">
                <div class="column-title">üëÄ Review <span class="column-count">0</span></div>
            </div>
            <div class="cards" data-status="review"></div>
        </div>
        <div class="column done" data-column="done">
            <div class="column-header">
                <div class="column-title">‚úÖ Done <span class="column-count">0</span></div>
            </div>
            <div class="cards" data-status="done"></div>
        </div>
    </div>
    
    <button class="fab" onclick="openAddModal()">+</button>
    
    <!-- Add Task Modal -->
    <div class="modal" id="addModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>New Task</h2>
                <button class="close-btn" onclick="closeModal('addModal')">√ó</button>
            </div>
            <form onsubmit="submitNewTask(event)">
                <div class="form-group">
                    <label>Title</label>
                    <input type="text" id="addTitle" placeholder="What needs to be done?" required>
                </div>
                <div class="form-group">
                    <label>Description</label>
                    <textarea id="addDesc" placeholder="Add details..."></textarea>
                </div>
                <div class="form-group">
                    <label>Category</label>
                    <select id="addCategory">
                        <option value="dev">üíª Dev</option>
                        <option value="marketing">üì£ Marketing</option>
                        <option value="content">üé® Content</option>
                        <option value="ambassador">ü§ù Ambassador</option>
                        <option value="ops">‚öôÔ∏è Ops</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Priority</label>
                    <select id="addPriority">
                        <option value="high">üî¥ High</option>
                        <option value="medium">üü° Medium</option>
                        <option value="low">üü¢ Low</option>
                    </select>
                </div>
                <div class="btn-group">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('addModal')">Cancel</button>
                    <button type="submit" class="btn btn-primary">Create Task</button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Task Detail Modal -->
    <div class="modal" id="detailModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Task Details</h2>
                <button class="close-btn" onclick="closeModal('detailModal')">√ó</button>
            </div>
            <form onsubmit="saveTask(event)">
                <input type="hidden" id="editId">
                <div class="form-group">
                    <label>Status</label>
                    <select id="editStatus">
                        <option value="todo">üìã To Do</option>
                        <option value="progress">üî• In Progress</option>
                        <option value="review">üëÄ Review</option>
                        <option value="done">‚úÖ Done</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Title</label>
                    <input type="text" id="editTitle" required>
                </div>
                <div class="form-group">
                    <label>Description</label>
                    <textarea id="editDesc"></textarea>
                </div>
                <div class="form-group">
                    <label>Category</label>
                    <select id="editCategory">
                        <option value="dev">üíª Dev</option>
                        <option value="marketing">üì£ Marketing</option>
                        <option value="content">üé® Content</option>
                        <option value="ambassador">ü§ù Ambassador</option>
                        <option value="ops">‚öôÔ∏è Ops</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Priority</label>
                    <select id="editPriority">
                        <option value="high">üî¥ High</option>
                        <option value="medium">üü° Medium</option>
                        <option value="low">üü¢ Low</option>
                    </select>
                </div>
                
                <!-- Files -->
                <div class="form-group">
                    <label>Files</label>
                    <label class="file-upload">
                        <input type="file" id="fileInput" onchange="addFile(this)">
                        <div class="file-upload-icon">üìé</div>
                        <div class="file-upload-text">Tap to upload file</div>
                    </label>
                    <div class="file-list" id="fileList"></div>
                </div>
                
                <div class="btn-group">
                    <button type="button" class="btn btn-danger" onclick="deleteTask()">Delete</button>
                    <button type="submit" class="btn btn-primary">Save Changes</button>
                </div>
            </form>
        </div>
    </div>
    
    <script>
        // State
        let state = { tasks: [] };
        let currentTaskId = null;
        let dragState = { card: null, preview: null };
        
        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            loadState();
            renderBoard();
            setupDragDrop();
        });
        
        function loadState() {
            const raw = localStorage.getItem('mission_control_v1');
            if (raw) {
                state = JSON.parse(raw);
            } else {
                state.tasks = [
                    { id: Date.now(), title: "Setup Mission Control", desc: "Board is live!", category: "ops", priority: "high", status: "done", files: [] },
                    { id: Date.now()+1, title: "Create Templates", desc: "Need templates for launch", category: "content", priority: "high", status: "todo", files: [] }
                ];
                saveState();
            }
        }
        
        function saveState() {
            localStorage.setItem('mission_control_v1', JSON.stringify(state));
            renderStats();
        }
        
        function renderBoard() {
            document.querySelectorAll('.cards').forEach(el => el.innerHTML = '');
            
            state.tasks.forEach(task => {
                const card = createCardElement(task);
                const col = document.querySelector(`.cards[data-status="${task.status}"]`);
                if (col) col.appendChild(card);
            });
            
            renderStats();
        }
        
        function createCardElement(task) {
            const div = document.createElement('div');
            div.className = 'card';
            div.dataset.id = task.id;
            div.dataset.status = task.status;
            
            const tagClass = `tag-${task.category}`;
            const priorityClass = `priority-${task.priority}`;
            const fileIcon = task.files?.length ? 'üìé' : '';
            
            div.innerHTML = `
                <div class="card-title">${task.title}</div>
                <div class="card-meta">
                    <span class="tag ${tagClass}">${getCategoryLabel(task.category)}</span>
                    <span class="priority-dot ${priorityClass}"></span>
                    ${fileIcon ? `<span class="file-indicator">${fileIcon}</span>` : ''}
                </div>
            `;
            
            div.addEventListener('click', () => openDetail(task.id));
            div.addEventListener('touchstart', handleTouchStart, { passive: true });
            
            return div;
        }
        
        function getCategoryLabel(cat) {
            const labels = { dev: 'Dev', marketing: 'Marketing', content: 'Content', ambassador: 'Ambassador', ops: 'Ops' };
            return labels[cat] || cat;
        }
        
        function renderStats() {
            const counts = { total: 0, todo: 0, progress: 0, review: 0, done: 0 };
            state.tasks.forEach(t => {
                counts.total++;
                counts[t.status]++;
            });
            document.getElementById('stat-total').textContent = counts.total;
            document.getElementById('stat-todo').textContent = counts.todo;
            document.getElementById('stat-progress').textContent = counts.progress;
            document.getElementById('stat-done').textContent = counts.done;
            
            document.querySelectorAll('.column').forEach(col => {
                const status = col.dataset.column;
                const countEl = col.querySelector('.column-count');
                if (countEl) countEl.textContent = counts[status] || 0;
            });
        }
        
        // Drag & Drop
        function setupDragDrop() {
            document.querySelectorAll('.column').forEach(col => {
                col.addEventListener('dragover', e => {
                    e.preventDefault();
                    col.classList.add('drag-over');
                });
                col.addEventListener('dragleave', () => col.classList.remove('drag-over'));
                col.addEventListener('drop', handleDrop);
            });
        }
        
        function handleTouchStart(e) {
            const card = e.currentTarget;
            const touch = e.changedTouches[0];
            
            dragState.card = card;
            
            card.style.opacity = '0.5';
            card.classList.add('dragging');
            
            document.addEventListener('touchmove', handleTouchMove, { passive: false });
            document.addEventListener('touchend', handleTouchEnd);
        }
        
        function handleTouchMove(e) {
            if (!dragState.card) return;
            e.preventDefault();
            
            const touch = e.changedTouches[0];
            const element = document.elementFromPoint(touch.clientX, touch.clientY);
            const column = element?.closest('.column');
            
            document.querySelectorAll('.column').forEach(c => c.classList.remove('drag-over'));
            if (column) column.classList.add('drag-over');
        }
        
        function handleTouchEnd(e) {
            if (!dragState.card) return;
            
            const touch = e.changedTouches[0];
            const element = document.elementFromPoint(touch.clientX, touch.clientY);
            const column = element?.closest('.column');
            
            if (column) {
                const newStatus = column.dataset.column;
                const taskId = dragState.card.dataset.id;
                const task = state.tasks.find(t => t.id == taskId);
                if (task && task.status !== newStatus) {
                    task.status = newStatus;
                    saveState();
                    renderBoard();
                }
            }
            
            dragState.card.style.opacity = '';
            dragState.card.classList.remove('dragging');
            document.querySelectorAll('.column').forEach(c => c.classList.remove('drag-over'));
            dragState.card = null;
            
            document.removeEventListener('touchmove', handleTouchMove);
            document.removeEventListener('touchend', handleTouchEnd);
        }
        
        function handleDrop(e) {
            e.preventDefault();
            const column = e.currentTarget;
            const newStatus = column.dataset.column;
            const taskId = dragState.card?.dataset.id;
            
            if (taskId && newStatus) {
                const task = state.tasks.find(t => t.id == taskId);
                if (task && task.status !== newStatus) {
                    task.status = newStatus;
                    saveState();
                    renderBoard();
                }
            }
            
            column.classList.remove('drag-over');
        }
        
        // Modals
        function openAddModal() {
            document.getElementById('addModal').classList.add('active');
            document.getElementById('addTitle').focus();
        }
        
        function openDetail(id) {
            currentTaskId = id;
            const task = state.tasks.find(t => t.id == id);
            if (!task) return;
            
            document.getElementById('editId').value = id;
            document.getElementById('editTitle').value = task.title;
            document.getElementById('editDesc').value = task.desc || '';
            document.getElementById('editStatus').value = task.status;
            document.getElementById('editCategory').value = task.category;
            document.getElementById('editPriority').value = task.priority;
            
            renderFileList(task.files || []);
            
            document.getElementById('detailModal').classList.add('active');
        }
        
        function closeModal(id) {
            document.getElementById(id).classList.remove('active');
            currentTaskId = null;
        }
        
        // Tasks
        function submitNewTask(e) {
            e.preventDefault();
            
            const newTask = {
                id: Date.now().toString(),
                title: document.getElementById('addTitle').value,
                desc: document.getElementById('addDesc').value,
                category: document.getElementById('addCategory').value,
                priority: document.getElementById('addPriority').value,
                status: 'todo',
                files: []
            };
            
            state.tasks.push(newTask);
            saveState();
            renderBoard();
            closeModal('addModal');
            
            e.target.reset();
        }
        
        function saveTask(e) {
            e.preventDefault();
            if (!currentTaskId) return;
            
            const task = state.tasks.find(t => t.id == currentTaskId);
            if (!task) return;
            
            task.title = document.getElementById('editTitle').value;
            task.desc = document.getElementById('editDesc').value;
            task.status = document.getElementById('editStatus').value;
            task.category = document.getElementById('editCategory').value;
            task.priority = document.getElementById('editPriority').value;
            
            saveState();
            renderBoard();
            closeModal('detailModal');
        }
        
        function deleteTask() {
            if (!currentTaskId) return;
            if (!confirm('Delete this task?')) return;
            
            state.tasks = state.tasks.filter(t => t.id != currentTaskId);
            saveState();
            renderBoard();
            closeModal('detailModal');
        }
        
        // Files
        function addFile(input) {
            if (!currentTaskId || !input.files[0]) return;
            
            const task = state.tasks.find(t => t.id == currentTaskId);
            if (!task) return;
            
            task.files = task.files || [];
            task.files.push({
                name: input.files[0].name,
                type: input.files[0].type,
                size: input.files[0].size
            });
            
            saveState();
            renderFileList(task.files);
            input.value = '';
        }
        
        function renderFileList(files) {
            const list = document.getElementById('fileList');
            list.innerHTML = files.map((f, i) => `
                <div class="file-item">
                    <span class="file-item-icon">üìÑ</span>
                    <span class="file-item-name">${f.name}</span>
                    <button type="button" class="file-item-remove" onclick="removeFile(${i})">√ó</button>
                </div>
            `).join('');
        }
        
        function removeFile(index) {
            if (!currentTaskId) return;
            const task = state.tasks.find(t => t.id == currentTaskId);
            if (!task || !task.files) return;
            
            task.files.splice(index, 1);
            saveState();
            renderFileList(task.files);
        }
        
        // Close modal on outside click
        document.querySelectorAll('.modal').forEach(modal => {
            modal.addEventListener('click', e => {
                if (e.target === modal) closeModal(modal.id);
            });
        });
    </script>
</body>
</html>
